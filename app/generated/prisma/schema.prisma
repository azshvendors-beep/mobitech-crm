generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum Role {
  ADMIN
  MANAGER
  FIELD_EXECUTIVE
  MARKETING_EXECUTIVE
  TECHNICIAN
  STORE_OWNER
}

model User {
  id            String   @id @default(cuid())
  phone         String   @unique
  phoneVerified Boolean?
  salary        Decimal?
  payoutDate    Int?

  password           String
  email              String?
  dateOfJoining      DateTime?
  dateOfTermination  DateTime?
  profileImage       String?
  aadharFrontImage   String?
  aadharBackImage    String?
  qualificationImage String?
  VehicleFrontImage  String?
  VehicleBackImage   String?
  role               Role?
  storeId            String?
  mfaEnabled         Boolean         @default(false)
  mfaSecret          String?
  mfaVerified        Boolean         @default(false)
  createdBy          String?
  isAdmin            Boolean         @default(false)
  status             UserStatus      @default(ACTIVE)
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  sessions           Session[]
  manager            Manager?        @relation("ManagerToUser")
  technician         Technician?     @relation("TechnicianToUser")
  fieldExecutive     FieldExecutive? @relation("FieldExecToUser")
  salesExecutive     SalesExecutive? @relation("SalesExecToUser")
  store              Store?          @relation("StoreToUser")
  admin              Admin?          @relation("AdminToUser")
}

model Admin {
  userId     String  @id
  employeeId String  @unique
  firstName  String?
  lastName   String?
  user       User    @relation("AdminToUser", fields: [userId], references: [id], onDelete: Cascade)
}

model Manager {
  userId      String       @id
  user        User         @relation("ManagerToUser", fields: [userId], references: [id], onDelete: Cascade)
  firstName   String
  lastName    String
  employeeId  String       @unique
  aadharId    String       @unique
  bankDetails BankDetails?
}

model Technician {
  userId      String       @id
  user        User         @relation("TechnicianToUser", fields: [userId], references: [id], onDelete: Cascade)
  firstName   String
  lastName    String
  employeeId  String       @unique
  aadharId    String       @unique
  bankDetails BankDetails?
}

model FieldExecutive {
  userId      String       @id
  user        User         @relation("FieldExecToUser", fields: [userId], references: [id], onDelete: Cascade)
  firstName   String
  lastName    String
  employeeId  String       @unique
  aadharId    String       @unique
  bankDetails BankDetails?
}

model SalesExecutive {
  userId      String       @id
  user        User         @relation("SalesExecToUser", fields: [userId], references: [id], onDelete: Cascade)
  firstName   String
  lastName    String
  employeeId  String       @unique
  aadharId    String       @unique
  bankDetails BankDetails?
}

model Store {
  userId      String       @id
  user        User         @relation("StoreToUser", fields: [userId], references: [id], onDelete: Cascade)
  storeId     String       @unique
  storeName   String
  ownerName   String
  ownerPhone  String
  ownerEmail  String
  address     Address?
  bankDetails BankDetails?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model BankDetails {
  id              String  @id @default(cuid())
  accountNumber   String?
  ifsc            String?
  bankName        String?
  beneficiaryName String?
  upiId           String?

  managerId    String? @unique
  technicianId String? @unique
  fieldExecId  String? @unique
  salesExecId  String? @unique
  storeId      String? @unique

  manager        Manager?        @relation(fields: [managerId], references: [userId], onDelete: Cascade)
  technician     Technician?     @relation(fields: [technicianId], references: [userId], onDelete: Cascade)
  fieldExecutive FieldExecutive? @relation(fields: [fieldExecId], references: [userId], onDelete: Cascade)
  salesExecutive SalesExecutive? @relation(fields: [salesExecId], references: [userId], onDelete: Cascade)
  store          Store?          @relation(fields: [storeId], references: [userId], onDelete: Cascade)
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())

  ipAddress String?
  userAgent String?
  device    String?
  browser   String?
  os        String?
  location  String?
  latitude  Float?
  longitude Float?

  @@index([userId])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  title     String
  body      String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}

model DeviceTest {
  id         String   @id @default(cuid())
  testId     String   @unique
  employeeId String?
  imageUrl   String?
  expiresAt  DateTime
  device     Json
  imei1      String?
  imei2      String?

  connectivityTestResults ConnectivityTestResult[]
  simTestResults          SimTestResult[]
  deviceTestResults       DeviceTestResult[]
  screenTest              ScreenTest?
  audioTest               AudioTest?
  proximitySensorTest     ProximitySensorTest?
  cameraTest              CameraTest?
  fingerprintTest         FingerprintTest?
  usbTest                 UsbTest?
  audioJackTest           AudioJackTest?

  createdAt DateTime @default(now())
}

model ConnectivityTestResult {
  id           String     @id @default(cuid())
  name         String
  status       Boolean
  message      String?
  timestamp    DateTime?
  deviceTestId String
  deviceTest   DeviceTest @relation(fields: [deviceTestId], references: [id], onDelete: Cascade)
}

model DeviceTestResult {
  id           String     @id @default(cuid())
  name         String
  status       Boolean
  message      String?
  timestamp    DateTime?
  deviceTestId String
  deviceTest   DeviceTest @relation(fields: [deviceTestId], references: [id], onDelete: Cascade)
}

model SimTestResult {
  id     String  @id @default(cuid())
  name   String
  status Boolean

  timestamp    DateTime?
  deviceTestId String
  deviceTest   DeviceTest @relation(fields: [deviceTestId], references: [id], onDelete: Cascade)
}

model ScreenTest {
  id           String     @id @default(cuid())
  multiTouch   Boolean
  dotCoverage  Boolean
  completed    Boolean
  timestamp    DateTime?
  deviceTestId String     @unique
  deviceTest   DeviceTest @relation(fields: [deviceTestId], references: [id], onDelete: Cascade)
}

model AudioTest {
  id           String     @id @default(cuid())
  speaker      Boolean
  earReceiver  Boolean
  microphone   Boolean
  timestamp    DateTime?
  deviceTestId String     @unique
  deviceTest   DeviceTest @relation(fields: [deviceTestId], references: [id], onDelete: Cascade)
}

model ProximitySensorTest {
  id           String     @id @default(cuid())
  status       Boolean
  message      String?
  timestamp    DateTime?
  deviceTestId String     @unique
  deviceTest   DeviceTest @relation(fields: [deviceTestId], references: [id], onDelete: Cascade)
}

model CameraTest {
  id           String     @id @default(cuid())
  frontCamera  Boolean
  backCamera   Boolean
  timestamp    DateTime?
  deviceTestId String     @unique
  deviceTest   DeviceTest @relation(fields: [deviceTestId], references: [id], onDelete: Cascade)
}

model FingerprintTest {
  id           String     @id @default(cuid())
  status       Boolean
  message      String?
  timestamp    DateTime?
  deviceTestId String     @unique
  deviceTest   DeviceTest @relation(fields: [deviceTestId], references: [id], onDelete: Cascade)
}

model UsbTest {
  id           String     @id @default(cuid())
  status       Boolean
  message      String?
  timestamp    DateTime?
  deviceTestId String     @unique
  deviceTest   DeviceTest @relation(fields: [deviceTestId], references: [id], onDelete: Cascade)
}

model AudioJackTest {
  id           String     @id @default(cuid())
  status       Boolean
  message      String?
  timestamp    DateTime?
  deviceTestId String     @unique
  deviceTest   DeviceTest @relation(fields: [deviceTestId], references: [id], onDelete: Cascade)
}

model ManualDiagnosticsResult {
  id          String  @id @default(cuid())
  diagnoseId  String  @unique
  employeeId  String?
  smc         String
  variant     String
  imei1       String?
  imei2       String?
  screenTouch String

  // Screen condition fields
  screenSpot     String
  screenLines    String
  screenPhysical String
  screenDiscolor String
  screenBubble   String

  // Functional Problems fields
  frontCamera    String
  backCamera     String
  audioJack      String
  wifi           String
  gps            String
  bluetooth      String
  volumeButton   String
  flashLight     String
  fcImageBlurred String
  bcImageBlurred String
  vibrator       String
  battery        String
  speaker        String
  microphone     String
  fingerprint    String
  proximity      String
  chargingPort   String
  powerButton    String
  faceLock       String
  copyScreen     String
  sim            String

  // Physical Condition fields
  physicalScratch String
  physicalDent    String
  physicalPanel   String
  physicalBent    String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Declaration {
  id                String   @id @default(cuid())
  orderId           String   @unique
  brand             String
  model             String
  smc               String
  variant           String
  imei1             String?
  imei2             String?
  bluetooth         String?
  gps               String?
  wifi              String?
  proximity         String?
  multiTouch        String?
  screenCalibration String?
  speaker           String?
  earReceiver       String?
  microphone        String?
  frontCamera       String?
  backCamera        String?
  sim               String?
  fingerprint       String?
  chargingPort      String?
  audioJack         String?
  isAccepted        Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model Address {
  id            String @id @default(cuid())
  streetAddress String
  city          String
  state         String
  country       String
  pinCode       String
  storeId       String @unique
  store         Store  @relation(fields: [storeId], references: [userId], onDelete: Cascade)
}

model Otp {
  id         String   @id @default(uuid())
  identifier String
  otp        String
  expiresAt  DateTime
  used       Boolean  @default(false)
  createdAt  DateTime @default(now())
  attempts   Int      @default(0)
}

model CustomModelBrand {
  id          String        @id @default(cuid())
  name        String        @unique
  logo        String?
  apiEndpoint String?
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  models      CustomModel[]
}

model CustomModel {
  id        String           @id @default(cuid())
  name      String
  code      String
  brandId   String
  brand     CustomModelBrand @relation(fields: [brandId], references: [id], onDelete: Cascade)
  isActive  Boolean          @default(true)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  // @@unique([brandId, name])
  @@index([brandId])
}
